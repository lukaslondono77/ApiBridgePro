# Unified weather across two providers (global-ready)
weather_unified:
  providers:
    - name: openweather
      base_url: https://api.openweathermap.org/data/2.5
      auth: {type: api_key_query, name: appid, value: ${OPENWEATHER_KEY}}
      weight: 1
    - name: weatherapi
      base_url: https://api.weatherapi.com/v1
      auth: {type: api_key_query, name: key, value: ${WEATHERAPI_KEY}}
      weight: 1
  allow_paths:
    - "^/weather$"
    - "^/current.json$"
  strategy: {policy: fastest_healthy_then_cheapest, timeout_ms: 2000, retries: 1}
  cache_ttl_seconds: 60
  response_model: WeatherUnified
  transforms:
    response:
      # normalizes OWM and WeatherAPI into one object (temp_c, humidity, provider)
      jmes: >
        {
          "temp_c": ( (main.temp || current.temp_c)*1.0 - (main.temp ? 273.15 : 0) ),
          "humidity": current.humidity || main.humidity,
          "provider": meta.provider
        }
  budget:
    monthly_usd_max: 25
    on_exceed: downgrade_provider
  cost_per_call_usd: 0.0002
  passthrough_headers: ["content-type", "etag"]
  # PII protection example (optional)
  pii_protection:
    enabled: false
    auto_scan: true  # Auto-detect and redact PII patterns
    action: redact   # redact | tokenize | encrypt | hash

# GitHub basic
github:
  base_url: https://api.github.com
  auth: {type: bearer, token: ${GITHUB_TOKEN}}
  allow_paths:
    - "^/user$"
    - "^/users/[^/]+$"
    - "^/repos/[^/]+/[^/]+/issues$"
  cache_ttl_seconds: 15
  retries: 2

# Slack basics
slack:
  base_url: https://slack.com/api
  auth: {type: bearer, token: ${SLACK_BOT_TOKEN}}
  allow_paths:
    - "^/chat.postMessage$"
    - "^/conversations.list$"
  rate_limit: {capacity: 50, refill_per_sec: 30}

# ═══════════════════════════════════════════════════════════════════
# FREE APIS - NO KEYS NEEDED! Try these instantly!
# ═══════════════════════════════════════════════════════════════════

# JSONPlaceholder - Fake REST API for testing
jsonplaceholder:
  base_url: https://jsonplaceholder.typicode.com
  allow_paths:
    - "^/posts$"
    - "^/posts/[0-9]+$"
    - "^/users$"
    - "^/users/[0-9]+$"
    - "^/comments$"
    - "^/todos$"
  cache_ttl_seconds: 300
  rate_limit:
    capacity: 100
    refill_per_sec: 10
  budget:
    monthly_usd_max: 0  # Free API
    on_exceed: block
  cost_per_call_usd: 0.0

# REST Countries - Country information
restcountries:
  base_url: https://restcountries.com/v3.1
  allow_paths:
    - "^/name/.*$"
    - "^/alpha/.*$"
    - "^/all$"
    - "^/region/.*$"
  cache_ttl_seconds: 86400  # 24 hours (data rarely changes)
  rate_limit:
    capacity: 100
    refill_per_sec: 10
  budget:
    monthly_usd_max: 0
    on_exceed: block
  cost_per_call_usd: 0.0

# CoinGecko - Cryptocurrency prices
coingecko:
  base_url: https://api.coingecko.com/api/v3
  allow_paths:
    - "^/simple/price$"
    - "^/coins/markets$"
    - "^/coins/list$"
    - "^/ping$"
  cache_ttl_seconds: 60  # 1 minute (prices change)
  rate_limit:
    capacity: 50
    refill_per_sec: 1
  budget:
    monthly_usd_max: 0
    on_exceed: block
  cost_per_call_usd: 0.0

# Dog CEO - Random dog pictures
dog_api:
  base_url: https://dog.ceo/api
  allow_paths:
    - "^/breeds/image/random$"
    - "^/breeds/list/all$"
    - "^/breed/.*/images$"
  cache_ttl_seconds: 300
  rate_limit:
    capacity: 100
    refill_per_sec: 10
  budget:
    monthly_usd_max: 0
    on_exceed: block
  cost_per_call_usd: 0.0

# Open-Meteo - Real weather data (NO API KEY NEEDED!)
openmeteo:
  base_url: https://api.open-meteo.com/v1
  allow_paths:
    - "^/forecast$"
    - "^/forecast/.*$"
  cache_ttl_seconds: 600  # 10 minutes
  rate_limit:
    capacity: 100
    refill_per_sec: 10
  budget:
    monthly_usd_max: 0
    on_exceed: block
  cost_per_call_usd: 0.0

# ipify - Get user's public IP address (NO API KEY NEEDED!)
ipify:
  base_url: https://api.ipify.org
  allow_paths:
    - "^/$"
    - "^/\\?format=json$"
  cache_ttl_seconds: 60  # 1 minute
  rate_limit:
    capacity: 100
    refill_per_sec: 10
  budget:
    monthly_usd_max: 0
    on_exceed: block
  cost_per_call_usd: 0.0

# Advice Slip - Random life advice (NO API KEY NEEDED!)
adviceslip:
  base_url: https://api.adviceslip.com
  allow_paths:
    - "^/advice$"
    - "^/advice/.*$"
  cache_ttl_seconds: 0  # Get fresh advice each time
  rate_limit:
    capacity: 100
    refill_per_sec: 10
  budget:
    monthly_usd_max: 0
    on_exceed: block
  cost_per_call_usd: 0.0

